<%
=begin
This file is part of SSID.

SSID is free software: you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

SSID is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License
along with SSID.  If not, see <http://www.gnu.org/licenses/>.
=end
%>

<%

@legendTable = ""

def genLegendText(sim)
  "<tr valign='center'><td><div style='#{genLegendHeight(sim)} vertical-align: middle; overflow: hidden; display:inline-block; position: relative;top: 0px;left: 0px;background-color: #{get_color(sim)};width:100px;'>&nbsp;</div><div style='vertical-align: middle; display: inline-block; position: relative;left: 5px;top: 0px;color: black;'>&ge; #{sim}%</div></td></tr>"
end

def genLegendHeight(sim)
  "height: #{get_weight(sim)}px;"
end

def genLegend()

  @legendTable if @legendTable.length > 0
  text = "<table cellpadding='1' cellspacing='1' style='border-style:solid; border-width:thin; border-color:black; table-layout:fixed;' width=100" + "%" + "><col width='150'/><tr><th>Similarity</th></tr>"

  [90, 80, 70, 60, 50].each { |i|
    text << genLegendText(i)
  }

  text << "<tr valign='center'><td><div style='#{genLegendHeight(49)} vertical-align: middle; overflow: hidden; display:inline-block; position: relative;top: 0px;left: 0px;background-color: #{get_color(49)};width:100px;'>&nbsp;</div><div style='vertical-align: middle; display: inline-block; position: relative;left: 5px;top: 0px;color: black;'>< 50%</div></td></tr>"

  text << "</table>"

  @legendTable = text
end

def getSim(code1, code2, assignment_id)
  sql_query = "SELECT asr.* FROM assignment_sim_results as asr, assignment_codes as ac1, assignment_codes as ac2 WHERE (asr.id1 = ? OR asr.id1 = ?) AND (asr.id2 = ? OR asr.id2 = ?) AND asr.assignment_id = ? LIMIT 0, 1"
  asr = AssignmentSimResult.find_by_sql([sql_query, code1.id, code2.id, code1.id, code2.id, assignment_id])
  if (asr.length == 0)
    return nil
  end
  return asr.first.sim
end

def getCode(student, assignment_id)
  sql_query = "SELECT codes.* FROM assignment_sim_results as asr, assignment_codes as codes, students WHERE students.matric = ? AND codes.student_id = students.id AND asr.assignment_id = ? AND (asr.id1 = codes.id OR asr.id2 = codes.id) LIMIT 0, 1"
  code = AssignmentCode.find_by_sql([sql_query, student, assignment_id])
  if (code.length == 0)
    return nil
  end
  return code.first
end

assignments = @course.assignments

%>
          <div class="breadcrumb"><%= link_to "My Modules", {:action => "course_listing"}, :class => "breadcrumbItem" %> > <%= link_to @course.code, {:action => "assignment_listing", :course_id => @course.id}, :class => "breadcrumbItem" %> > <%= link_to "Visuals", {:action => "graph_view_ibetween", :course_id => @course.id}, :class => "breadcrumbItem" %> > Between individuals</div>
    <h2 style="padding-top: 10px;">Students Similarities:
      <%=
      if @students.size > 3 then
        txt = ""
        for j in (0...3)
          txt << @students[j] + ", "
        end
        txt << "... (Total: " + @students.size.to_s + " students)"
      else
        @students.join(", ")
      end
    %>
    </h2>
  <li>Student matric in <label style="color: red;">red</label> denotes the student is found guilty in plagiarism for the assignment</li>
  <li>To view student's log, click the student matric</li>
  <p/>
  <div id="infovis" style="background-color:white;visibility:visible;"/>
