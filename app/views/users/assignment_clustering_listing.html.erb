<%
=begin
This file is part of SSID.

SSID is free software: you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

SSID is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License
along with SSID.  If not, see <http://www.gnu.org/licenses/>.
=end
%>

<%
course = @assignment.course

def getGroupsURL(clustering)
  reply = "graph_clusters?"

  ids = []
  clustering.assignment_clusters.each { |cluster|
    ids << "clusters[]=" + cluster.id.to_s
  }

  reply << ids.join("&")

  return reply
end

def genTD(clustering)

  if clustering.assignment_clusters.size > 0
    #"onmouseover=\"Tip('Click to view plagiarism clusters');\" onmouseout=\"UnTip();\" onclick=\"document.location = '#{getGroupsURL(clustering)}';\""
    "onmouseover=\"Tip('Click to view plagiarism clusters');\" onmouseout=\"UnTip();\" onclick=\"window.open('#{getGroupsURL(clustering)}'); return false;\""
  else
    "style='cursor: default;' onmouseover=\"Tip('No plagiarism cluster detected')\" onmouseout=\"UnTip();\""
  end
end
%>

<div class="breadcrumb"><%= link_to "My Modules", {:action => "course_listing"}, :class => "breadcrumbItem" %> > <%= link_to course.code, {:action => "assignment_listing", :course_id => course.id}, :class => "breadcrumbItem" %> > <%= link_to "Assignment: #{@assignment.title}", {:action => "assignment_sim_result_view", :assignment_id => @assignment.id}, :class => "breadcrumbItem" %> > Groupings</div>
<h2>Groupings</h2>
<% if (@acs.size == 0) %>
  No grouping is available yet.
<% else %>
  <table class="listing">
    <col width="1*" />
    <col width="1*" />
    <col width="3*" />
    <col width="1*" />
    <thead class="listing">
      <tr class="listing">
        <th class="listing">Cut off criterion (%)</th>
        <th class="listing"># of plagiarism clusters</th>
        <th class="listing">Remarks</th>
        <th class="listing"></th>
      </tr>
    </thead>
    <tbody class="listing">
      <%
      @acs.each { |assignment_clustering|
      %>
        <tr class="listing" onmouseover="this.style.backgroundColor ='<%=highlightColor_row%>';" onmouseout="this.style.backgroundColor ='white';">
          <td class="listing" <%=genTD(assignment_clustering)%>><%= assignment_clustering.coc %></td>
          <td class="listing" <%=genTD(assignment_clustering)%>><%= assignment_clustering.assignment_clusters.size %></td>
          <td class="listing" <%=genTD(assignment_clustering)%>><%=assignment_clustering.remark %> (<%=assignment_clustering.created_at.strftime("%d/%m/%Y %H:%M:%S")%>)</td>
          <td class="listing" style="cursor: default;"><%= link_to 'Delete', {:action => 'assignment_clustering_delete', :assignment_id => assignment_clustering.assignment.id, :clustering_id => assignment_clustering.id}, :confirm => 'Are you sure?', :class => 'listingItem', :onmouseover => "Tip('Click to delete this grouping');", :onmouseout => "UnTip();",  :method => :delete %></td>
        </tr>
      <%
      }
    %>
    </tbody>
  </table>
  <p/><div class="instruction">To view plagiarism clusters, click the grouping</div>
<% end %>
<hr />
<%=  link_to 'New Grouping', {:action => "assignment_clustering_new", :assignment_id => @assignment.id}, :class => "normalLink" %>
